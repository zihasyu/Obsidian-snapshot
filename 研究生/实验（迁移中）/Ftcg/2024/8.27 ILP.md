### 为什么要有这个课题

在不考虑多重依赖增量压缩的前提下**(unique chunk不能基于一个delta chunk做增量压缩变为delta chunk，这会加大恢复开销，特别是涉及到了多次磁盘io开销)**，一个unique chunk,只能作为base chunk或者delta chunk中的一种。

假如出于贪心策略，每个块都想把自己作为delta chunk，但会缺少优质的base chunk，那么显然得不到一个全局最优解。//极端一些就是只有第一个块做base，后面的块都想对第一个块做delta，效果肯定很差很差。

而传统featureBase方案的效果显然不是最优解。（featureBase方案时间开销小，同时作为现实应用的解决方案也不需要最优解）

高中数学教过线性规划问题，已经实现的baseline方法就是通过线性规划来逐渐找到optimal，这个方法找到的解一定是在效果（overall compression ratio）上optimal，但这是很显然很直接的方案，我们需要更多的design来减少他的时间开销，否则无法真正地投入使用。

  ![[Pasted image 20250318234613.png]]

**题外话的个人理解：**

我们从经验主义出发可以认为全局最优解由两个方面组成：找到更多的相似块+舍弃会损害长远收益的相似块。

传统的featureBase类特征块选取方法有一个隐形的阈值，虽然featureBase的出发点是找到更多的相似块，但其实他找不全，所以一定程度上舍弃了“他觉得不太相似的”块，这使得有一个不显性的负反馈调节。

如果只是找真正的optimal，那么已经实现的baseline代码部分已经足够了，他在数学层面上确实一定能找到一个最优解。但这太慢了，希望能通过一些design来tradeoff这项工作，取得一个比featureBase方法效果好很多的伪optimal，但时间开销又相对能接受的方案。

# Delta compression 一般流程

暂时无法在成电飞书文档外展示此内容

# ILP问题抽象

## 准备工作

- 需要预先计算每个chunk做Lz4的compression size
    
- 需要预先计算每个chunk基于其之前进入系统的chunk的delta compression size
    

## 相关变量 ILP

每个chunk设置以下变量：

- Xi: 标志第i个chunk是否进行无损存储
    
- Y[i][j]: 标志chunk i 是否基于 chunk j 做 delta compression
    
- Z[i]: 标志chunk i是否为delta chunk
    

## 约束设置

### 每个chunk要么全量存储，要么增量存储

Xi + ΣY[i][j] == 1

### 只允许选择序号比自己小的 chunk作为baseChunk

仅当i>j时让Y[i][j]有定义即可

### 不能选择deltachunk作为basechunk

  

X*size +

求解器