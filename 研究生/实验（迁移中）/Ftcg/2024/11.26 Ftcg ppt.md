# Fine-to-Coarse Hierarchical Group Aggregation for Effective Lossless Compression

1. ## 为什么要做固定长分组无损压缩
    

### 1.1 固定长：（对比fastcdc）

#### **固定长切块**：

- 切块的边界固定，块大小一致，**块数量确定**。
    
- 便于随机访问。
    

#### **FastCDC**：

- 切块边界动态变化，块大小不固定，**块数量不确定**。
    
- 切块后需要额外存储边界信息（起始位置和块大小）才能重建原始数据，此外不能在没有这些数据的前提下做到随机访问。
    
- 断点计算增加了复杂性，可能不适合某些实时性或简化存储需求的场景。
    

### 1.2 分组无损压缩：（对比顺序无损压缩）

#### 分组无损压缩：

- 如果直接对所有块直接的做顺序无损压缩，有些重复度很高的块在无损压缩滑窗之外，这部分可去重的内容被忽略掉了。换言之，**频繁出现**隔很远会出现一组相似度很高的块时，才适合**分组无损压缩**。
    

#### 顺序无损压缩：

- 原本直接做**顺序无损压缩**的方法也是可取的，他适合在**去重率低**的场景使用，例如在只有1个backup时，做分组压缩找不到太多的重复块或相似块，反而会引入额外的时间开销与存储开销。
    

  

  

2. ## 传统分组无损压缩(baseline)的不足
    

### 2.1 基准方法：per chunk做无损压缩

### 2.2 **基于FP的分组(只用FP分一次)**

- ①粒度过细,分组过于严格，只有部分内容重复的块不能聚合到一个分组里。
    
- ②固定长自带的边界偏移问题，一点点偏移的存在会使**绝大部分块内容相似**的块的FP完全不同。
    

### 2.3 **基于SF的分组(只用odess分一次)**

- ③粒度过粗，分组过于宽松，内容重复更多的块（例如完全重复）不能优先聚合到一个分组里。
    
- ④固定长自带的边界偏移问题同样会影响SF的计算，使其有**小部分内容相同**的块其SF不同（哪怕是原始feature级别也不相同）
    

  

3. ## 传统分组无损压缩问题的提炼与解决方案
    

### problem1 the accuracy-versus-coverage dilemma

由①③引出该问题，精确度和覆盖率存在矛盾，**精确度优先的基于FP的分组**分组过于严格，只有部分内容重复的块不能聚合到一个分组里；**覆盖率优先的基于SF的分组**过于宽松，内容重复更多的块不能优先聚合到一个分组里**。两种方案都损失了一些潜在收益。**

### design1 Fine-to-Coarse Grouping

先做基于FP的分组，在保留FP分组的基础上做基于SF的分组，既使得内容完全重复的块优先聚合到一个分组里收获了精度，又能使相似度较高的块聚合在一起，收获了更高的覆盖率。

- 此外，该框架可以增添更粗粒度的分组方法来进一步获取收益。
    

  

  

### problem2 Boundary offset issues caused by fixed-size chunking

②④引出该问题，固定长切块有诸多优点，利于随机访问，不需要记录块大小块偏移即可找到位置等等。但是其切点处的hash值并不满足任何规律，所以在有内容插入或删除时，会使得附近未修改的内容也难以去重掉。

### design2 Sub-Chunk Sampling Mechanism

在固定长块内容运行期望size较小的fastcdc，可以得出若干切点hash满足一定规律的sub-chunk。选取size最大的sub-chunk（也可以是fp最小）作为代表块，此时子块的两个切点hash都满足一定规律。基于该子块的SF进行分组。

- 此方案的粒度更粗，所以增添至design1框架的最后。此外优先保证不会拆散完整块SF的分组，因为他的粒度更细。
    

### Data support

收益率：

![](https://uestc.feishu.cn/space/api/box/stream/download/asynccode/?code=Mzc0OTk2MWE1ZWZmMmExZjNmNDJkZjQyZGJmOTg5NDhfYnhlb1BhWThlcjNJWjRld0VOM1VITlI5czJIQTBFZkpfVG9rZW46VjdZcmIyRHl1b3JhTmd4UEdDcWNkbklybjVmXzE3NDIzMTI4NjU6MTc0MjMxNjQ2NV9WNA)

![](https://uestc.feishu.cn/space/api/box/stream/download/asynccode/?code=ODI5NzI5YWExZTRkNGY0MGFjYjVmNjViODhjZGE5ZmVfMG04bTZuZ29SSDAwQk03dzc1SUNmenEwMXRRb0JCbjFfVG9rZW46RUZQdGJpNGRBb200Ukx4U3RyWWNMYjBRbjhmXzE3NDIzMTI4NjU6MTc0MjMxNjQ2NV9WNA)

### Conclusion

- 精确度与覆盖度矛盾的问题 由design1 自细而粗的分组方法 来解决
    
- 固定长边界问题 由design2 基于内容的块抽样 来解决